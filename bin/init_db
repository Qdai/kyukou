#!/usr/bin/env node

'use strict';

const Bluebird = require('bluebird');

const dbConnection = require('../db');

const tasklogs = ['task', 'twit_new', 'twit_tomorrow', 'delete'].map(function (name) {
  return {
    name,
    log: 'initialized',
    level: 1,
    time: new Date(),
    elapsedTime: 0
  };
});

Bluebird.using(dbConnection(), function (db) {
  const Tasklog = db.model('Tasklog');
  return Promise.all(tasklogs.map(function (tasklog) {
    return new Promise(function (resolve, reject) {
      Tasklog.findOrCreate({
        name: tasklog.name
      }, tasklog, function (err, event, created) {
        if (err) {
          reject(err);
        } else {
          resolve(created);
        }
      });
    });
  }));
}).then(function () {
  console.log('msg: db init success');
}).catch(function (err) {
  console.log('err: ' + err.stack);
});
